<Project>
    <Import Project="$(ProjectDir)Tools.Config.props" Condition="Exists('$(ProjectDir)Tools.Config.props')"/>
    <Import Project="$(MSBuildThisFileDirectory)Tools.Config.props" Condition="!Exists('$(ProjectDir)Tools.Config.props')"/>
    <PropertyGroup>
        <IMetaType>ShadowPluginLoader.WinUI.Interfaces.IPluginMetaData</IMetaType>
        <ForcePluginLoaderTool  Condition="$(ForcePluginLoaderTool) == ''">false</ForcePluginLoaderTool>
        <IsPluginLoaderMetaBuild  Condition="$(IsPluginLoaderMetaBuild) == ''">false</IsPluginLoaderMetaBuild>
        <IsPlugin  Condition="$(IsPlugin) == ''">false</IsPlugin>
    </PropertyGroup>
    <PropertyGroup>
        <PluginToolTargetsFile Condition="$(PluginToolTargetsFile) == ''">$(ProjectDir)Tool.targets</PluginToolTargetsFile>
        <ToolExeFile>$(MSBuildThisFileDirectory)ShadowPluginLoader.Tool.dll</ToolExeFile>
        <OutputDir>$(ProjectDir)$(OutputPath)</OutputDir>
        <OutputFile>$(OutputDir)$(TargetName)$(TargetExt)</OutputFile>
    </PropertyGroup>

    <Import Project="$(PluginToolTargetsFile)" Condition="Exists('$(PluginToolTargetsFile)')"/>
    <Target Name="ExportMetaData" AfterTargets="CoreBuild"
            Condition="$(Configuration.Contains('Release')) and !Exists('$(PluginToolTargetsFile)') and $(IsPluginLoaderMetaBuild)">
        <Exec Command="dotnet $(ToolExeFile) 0 $(OutputFile) $(IMetaType) $(OutputDir) $(ProjectDir) $(ForcePluginLoaderTool)" ConsoleToMSBuild="True" />
    </Target>
    <Target Name="ReadMetaData" BeforeTargets="BeforeBuild"
            Condition="!Exists('$(PluginToolTargetsFile)') and $(IsPlugin) and !$(IsPluginLoaderMetaBuild)">
        <Exec Command="dotnet $(ToolExeFile) 1 $(ProjectDir) $(MSBuildProjectFile)" ConsoleToMSBuild="True" />
        <!--<Copy SourceFiles="$(ProjectDir)plugin.json" DestinationFiles="$(OutputDir)plugin.json" />-->
    </Target>
    <Target Name="CopyConfig" BeforeTargets="BeforeBuild"
            Condition="!Exists('$(ProjectDir)Tools.Config.props')">
        <Copy SourceFiles="$(MSBuildThisFileDirectory)Tools.Config.props" DestinationFiles="$(ProjectDir)Tools.Config.props" />
    </Target>
</Project>